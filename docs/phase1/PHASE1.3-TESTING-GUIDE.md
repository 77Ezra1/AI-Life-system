# Phase 1.3 指令系统测试指南 🧪

## ✅ **集成完成清单**

- [x] 导入指令系统相关模块到 ChatContainer
- [x] 添加指令相关状态管理
- [x] 实现 Ctrl+K 快捷键监听
- [x] 实现输入框 `/` 触发检测
- [x] 实现指令执行逻辑和上下文绑定
- [x] 渲染指令面板组件

---

## 🧪 **测试步骤**

### 1. 启动应用
```bash
# 确保前端和后端都在运行
npm run dev          # 前端 (http://localhost:5173)
node server/index.cjs # 后端 (http://localhost:3000)
```

### 2. 测试快捷键触发 (Ctrl+K)
**步骤**：
1. 进入聊天页面
2. 按下 `Ctrl+K` (Mac: `Cmd+K`)

**预期结果**：
- ✅ 指令面板弹出
- ✅ 显示所有可用指令
- ✅ 有搜索框可以过滤指令
- ✅ 指令按分类显示

### 3. 测试 `/` 触发
**步骤**：
1. 在输入框中（空白状态）
2. 按下 `/` 键

**预期结果**：
- ✅ 指令面板弹出（与 Ctrl+K 效果相同）
- ✅ `/` 字符不应该出现在输入框中

### 4. 测试常用指令

#### 4.1 `/help` - 帮助指令
**步骤**：
1. 打开指令面板
2. 搜索 "help"
3. 执行指令

**预期结果**：
- ✅ 显示帮助对话框
- ✅ 列出所有可用指令

#### 4.2 `/clear` - 清空对话
**步骤**：
1. 在有消息的对话中
2. 打开指令面板
3. 执行 `/clear`

**预期结果**：
- ✅ 弹出确认对话框
- ✅ 确认后清空所有消息

#### 4.3 `/new` - 新建对话
**步骤**：
1. 打开指令面板
2. 执行 `/new`

**预期结果**：
- ✅ 创建新的对话
- ✅ 切换到新对话

#### 4.4 `/code` - 编程模式
**步骤**：
1. 打开指令面板
2. 执行 `/code`

**预期结果**：
- ✅ 开启编程模式
- ✅ 右侧显示代码预览面板
- ✅ 再次执行切换回普通模式

### 5. 测试编辑指令

#### 5.1 `/regenerate` - 重新生成
**步骤**：
1. 在有AI回复的对话中
2. 执行 `/regenerate`

**预期结果**：
- ✅ 重新生成最后一条AI消息

#### 5.2 `/edit` - 编辑消息
**步骤**：
1. 在有用户消息的对话中
2. 执行 `/edit`

**预期结果**：
- ✅ 进入编辑模式
- ✅ 可以修改最后一条用户消息

#### 5.3 `/undo` - 撤销
**步骤**：
1. 在有对话的情况下
2. 执行 `/undo`

**预期结果**：
- ✅ 删除最后一组对话（用户+AI）

### 6. 测试导出指令

#### 6.1 `/export-md` - 导出Markdown
**步骤**：
1. 在有消息的对话中
2. 执行 `/export-md`

**预期结果**：
- ✅ 下载 Markdown 文件
- ✅ 文件包含所有消息内容

#### 6.2 `/export-json` - 导出JSON
**步骤**：
1. 在有消息的对话中
2. 执行 `/export-json`

**预期结果**：
- ✅ 下载 JSON 文件
- ✅ 文件包含对话的完整数据结构

### 7. 测试AI功能指令

#### 7.1 `/summarize` - 总结对话
**步骤**：
1. 在有多条消息的对话中
2. 执行 `/summarize`

**预期结果**：
- ✅ 发送总结请求给AI
- ✅ AI返回对话摘要

#### 7.2 `/translate` - 翻译
**步骤**：
1. 有消息的对话中
2. 执行 `/translate`
3. 输入目标语言（如：English）

**预期结果**：
- ✅ 发送翻译请求
- ✅ AI返回翻译结果

### 8. 测试搜索指令

#### 8.1 `/search` - 搜索消息
**步骤**：
1. 执行 `/search`
2. 输入搜索关键词

**预期结果**：
- ✅ 显示搜索结果
- ✅ 高亮匹配的消息

---

## 🎯 **性能测试**

### 1. 快捷键响应速度
- ✅ Ctrl+K 应在 100ms 内打开面板
- ✅ `/` 触发应在 100ms 内打开面板

### 2. 指令执行速度
- ✅ 简单指令（如清空、切换模式）应立即执行
- ✅ AI指令（如总结、翻译）应在 1-5 秒内返回结果

### 3. UI 响应性
- ✅ 指令面板搜索应实时过滤
- ✅ 指令面板应支持键盘导航（上下箭头）
- ✅ 按 ESC 应关闭面板

---

## 🐛 **常见问题排查**

### 问题1: 按 Ctrl+K 没有反应
**可能原因**：
- 快捷键被浏览器拦截
- JavaScript事件监听未正确添加

**排查方法**：
1. 打开浏览器控制台
2. 检查是否有错误信息
3. 检查控制台是否输出：`[ChatContainer] Ctrl+K pressed`

### 问题2: `/` 触发不工作
**可能原因**：
- 输入框不在空白状态
- `onCommandTrigger` 回调未正确传递

**排查方法**：
1. 确保输入框为空
2. 检查控制台错误信息
3. 检查 `MessageInput` 是否接收到 `onCommandTrigger` prop

### 问题3: 指令执行失败
**可能原因**：
- 上下文缺少必要的函数
- 指令逻辑有错误

**排查方法**：
1. 打开控制台查看 `[Command]` 相关日志
2. 检查是否有 `undefined is not a function` 错误
3. 验证 `executeCommand` 中的上下文对象是否完整

### 问题4: 指令面板不显示
**可能原因**：
- CSS 样式未正确加载
- `CommandPalette` 组件导入失败

**排查方法**：
1. 检查控制台是否有模块导入错误
2. 检查 `CommandPalette.css` 是否被加载
3. 检查 DOM 中是否存在 `.command-palette` 元素

---

## 📊 **测试结果报告模板**

### 基本功能测试
- [ ] Ctrl+K 触发 - 通过/失败
- [ ] `/` 触发 - 通过/失败
- [ ] `/help` - 通过/失败
- [ ] `/clear` - 通过/失败
- [ ] `/new` - 通过/失败
- [ ] `/code` - 通过/失败

### 编辑功能测试
- [ ] `/regenerate` - 通过/失败
- [ ] `/edit` - 通过/失败
- [ ] `/undo` - 通过/失败

### 导出功能测试
- [ ] `/export-md` - 通过/失败
- [ ] `/export-json` - 通过/失败

### AI功能测试
- [ ] `/summarize` - 通过/失败
- [ ] `/translate` - 通过/失败

### 搜索功能测试
- [ ] `/search` - 通过/失败

### UI/UX测试
- [ ] 面板样式正常 - 通过/失败
- [ ] 键盘导航正常 - 通过/失败
- [ ] ESC关闭正常 - 通过/失败

---

## ✅ **下一步**

完成所有测试后：
1. 记录测试结果
2. 修复发现的bug
3. 创建 `PHASE1.3-COMPLETE.md` 文档
4. 更新项目进度

---

**测试人员**: _______
**测试日期**: 2025-10-15
**测试环境**: Windows 10, Chrome
**测试版本**: Phase 1.3

